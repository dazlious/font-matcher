{"version":3,"sources":["helpers.js","App.js","index.js"],"names":["toPx","num","clamp","min","max","Math","renderDelay","time","Promise","resolve","setTimeout","DEFAULT_TEXT","canvasTxt","vAlign","align","justify","PIXELMATCH_OPTIONS","threshold","includeAA","diffMask","CANVAS_WIDTH","CANVAS_HEIGHT","DEFAULT_FONT_WEIGHT","DEFAULT_FALLBACK_FAMILY","DEFAULT_TEXT_TRANSFORM","BG_COLOR_WHITE","BG_COLOR_BLACK","BG_COLOR_FALLBACK","BG_COLOR_WEBFONT","INITIAL_LETTER_SPACING","INITIAL_WORD_SPACING","CANVAS_FRAME_FULL","CANVAS_FRAME_TEXT","getImageData","canvas","ctx1","getContext","data","createEmptyDiff","diffCtx","clearRect","createImageData","drawColoredRect","color","ctx","fillStyle","fillRect","draw","txt","bgColor","fontFamily","fontSize","lineHeight","fontWeight","textTransform","letterSpacing","wordSpacing","transformedText","getTransformedText","style","font","Number","drawText","transformType","toUpperCase","toLowerCase","drawResult","originalFont","fallbackFont","wordSpacingOriginal","letterSpacingOriginal","drawFallbackWithSettings","originalImage","fallbackRef","diffRef","text","textSettings","bgFallbackColor","current","fallbackImage","diff","result","pixelmatch","App","useState","webfontFamily","setWebfontFamily","fallbackFamily","setFallbackFamily","setText","setFontSize","setLineHeight","setFontWeight","setLetterSpacing","setWordSpacing","setTextTransform","drawAreaRef","useRef","resultRef","webfontRef","useEffect","onMatch","a","progress","display","opacity","basicFontSettings","fallbackFontSettings","webFontSettings","LETTER_SPACING_BOUNDARIES","lsFrom","lsTo","WORD_SPACING_BOUNDARIES","anchorStepSize","currentStepSizeX","currentStepSizeY","wsTo","wsFrom","x","y","arr","map","round","reduce","acc","curr","res","localMin","localMinIndex","indexOf","nextMin","putImageData","innerText","JSON","stringify","pow","onChange","changeHandler","value","target","className","htmlFor","onBlur","bind","id","type","step","defaultValue","accept","e","files","file","callback","name","split","fontFaceName","url","URL","createObjectURL","document","createElement","textContent","head","appendChild","uploadFontFace","onClick","ref","width","height","ReactDOM","render","StrictMode","getElementById"],"mappings":"gUAAaA,EAAO,SAACC,GAAD,gBAAYA,EAAZ,OAEPC,EAAQ,SAACD,EAAKE,EAAKC,GAAX,OAAmBC,KAAKF,IAAIE,KAAKD,IAAIH,EAAKE,GAAMC,IAExDE,EAAc,eAACC,EAAD,uDAAQ,IAAR,OAAiB,IAAIC,SAAQ,SAACC,GAAD,OAAaC,WAAWD,EAASF,O,eCInFI,EACJ,gcAKFC,IAAUC,OAAS,MACnBD,IAAUE,MAAQ,OAClBF,IAAUG,SAAU,EAEpB,IAAMC,EAAqB,CACzBC,UAAW,GACXC,WAAW,EACXC,UAAU,GAMNC,EAAe,IACfC,EAAgB,IAEhBC,EAAsB,IAItBC,EAA0B,kBAG1BC,EAAyB,OAEzBC,EAAiB,OAEjBC,EAAiB,OACjBC,EAAoB,UACpBC,EAAmB,UAEnBC,EAAyB7B,EAdA,GAezB8B,EAAuB9B,EAdA,GAgBvB+B,EAAoB,CAAC,EAAG,EAAGX,EAAcC,GAEzCW,EAAoB,CA1BD,GACA,GA4BvBZ,IACAC,KAGIY,EAAe,SAACC,GACpB,IAAMC,EAAOD,EAAOE,WAAW,MAC/B,OAAOD,EAAKF,aAAL,MAAAE,EAAqBJ,GAAmBM,MAG3CC,EAAkB,SAACJ,GACvB,IAAMK,EAAUL,EAAOE,WAAW,MAElC,OADAG,EAAQC,UAAR,MAAAD,EAAqBR,GACdQ,EAAQE,gBAAgBrB,EAAcC,IAQzCqB,EAAkB,SAACR,GAAoC,IAA5BS,EAA2B,uDAAnBlB,EACjCmB,EAAMV,EAAOE,WAAW,MAC9BQ,EAAIJ,UAAJ,MAAAI,EAAiBb,GACjBa,EAAIC,UAAYF,EAChBC,EAAIE,SAAJ,MAAAF,EAAgBb,IAGZgB,EAAO,SACXb,EACAc,EAFW,EAYXC,GACI,IATFC,EASC,EATDA,WACAC,EAQC,EARDA,SACAC,EAOC,EAPDA,WAOC,IANDC,kBAMC,MANY/B,EAMZ,MALDgC,qBAKC,MALe9B,EAKf,MAJD+B,qBAIC,MAJe1B,EAIf,MAHD2B,mBAGC,MAHa1B,EAGb,EACG2B,EAAkBC,EAAmBV,EAAKM,GAC1CV,EAAMV,EAAOE,WAAW,MAC9BM,EAAgBR,EAAQe,GACxBf,EAAOyB,MAAMJ,cAAgBA,EAC7BrB,EAAOyB,MAAMH,YAAcA,EAC3BZ,EAAIC,UAAYnB,EAChBd,IAAUgD,KAAOV,EACjBtC,IAAUyC,WAAaQ,OAAOR,GAC9BzC,IAAUuC,SAAWU,OAAOV,GAC5BvC,IAAUwC,WAAaS,OAAOT,GAAcS,OAAOV,GACnDvC,IAAUkD,SAAV,MAAAlD,IAAS,CAAUgC,EAAKa,GAAf,OAAmCzB,KAGxC0B,EAAqB,SAACV,EAAKe,GAC/B,OAAQA,GACN,IAAK,YACH,OAAOf,EAAIgB,cACb,IAAK,YACH,OAAOhB,EAAIiB,cACb,IAAK,OACL,QACE,OAAOjB,IAIPkB,EAAa,SACjBhC,EACAc,EACAmB,EACAC,EAJiB,GAeb,IATFjB,EASC,EATDA,SACAC,EAQC,EARDA,WAQC,IAPDC,kBAOC,MAPY/B,EAOZ,MAND+C,2BAMC,MANqBvC,EAMrB,MALDwC,6BAKC,MALuBzC,EAKvB,MAJDyB,qBAIC,MAJe9B,EAIf,MAHD+B,qBAGC,MAHe1B,EAGf,MAFD2B,mBAEC,MAFa1B,EAEb,EACG2B,EAAkBC,EAAmBV,EAAKM,GAC1CV,EAAMV,EAAOE,WAAW,MAC9BM,EAAgBR,EAAQT,GACxBmB,EAAIC,UAAYnB,EAChBQ,EAAOyB,MAAMJ,cAAgBe,EAC7BpC,EAAOyB,MAAMH,YAAca,EAC3BzD,IAAUyC,WAAaQ,OAAOR,GAC9BzC,IAAUgD,KAAOO,EACjBvD,IAAUuC,SAAWU,OAAOV,GAC5BvC,IAAUwC,WAAaS,OAAOT,GAAcS,OAAOV,GACnDvC,IAAUkD,SAAV,MAAAlD,IAAS,CAAUgC,EAAKa,GAAf,OAAmCzB,IAE5CE,EAAOyB,MAAMJ,cAAgBA,EAC7BrB,EAAOyB,MAAMH,YAAcA,EAC3BZ,EAAIC,UA7Ge,UA8GnBjC,IAAUgD,KAAOQ,EACjBxD,IAAUyC,WAAaQ,OAAOR,GAC9BzC,IAAUuC,SAAWU,OAAOV,GAC5BvC,IAAUwC,WAAaS,OAAOT,GAAcS,OAAOV,GACnDvC,IAAUkD,SAAV,MAAAlD,IAAS,CAAUgC,EAAKa,GAAf,OAAmCzB,KAGxCuC,EAA2B,SAC/BC,EACAC,EACAC,EACAC,EACAC,GAEI,IADJC,EACG,uDADelD,EAElBoB,EAAK0B,EAAYK,QAASH,EAAMC,EAAcC,GAC9C,IAAME,EAAgB9C,EAAawC,EAAYK,SACzCE,EAAO1C,EAAgBoC,EAAQI,SAE/BG,EAASC,IAAWV,EAAeO,EAAeC,EAAK3C,KAAMjB,EAAcC,EAAeL,GAEhG,MAAO,CAACiE,EAAQD,IA6WHG,EAtVH,WAAO,IAAD,EAC0BC,mBAlKb,WAiKb,mBACTC,EADS,KACMC,EADN,OAE4BF,mBAAS7D,GAFrC,mBAETgE,EAFS,KAEOC,EAFP,OAIQJ,mBAASzE,GAJjB,mBAITgE,EAJS,KAIHc,EAJG,OAKgBL,mBApKR,IA+JR,mBAKTjC,EALS,KAKCuC,EALD,OAMoBN,mBApKV,KA8JV,mBAMThC,EANS,KAMGuC,EANH,OAOoBP,mBAAS9D,GAP7B,mBAOT+B,EAPS,KAOGuC,EAPH,OAQ0BR,mBA3Kb,GAmKb,mBAQT7B,EARS,KAQMsC,EARN,OASsBT,mBA3KX,GAkKX,mBAST5B,GATS,KASIsC,GATJ,QAU0BV,mBAAS5D,GAVnC,qBAUT8B,GAVS,MAUMyC,GAVN,MAYVC,GAAcC,iBAAO,MACrBC,GAAYD,iBAAO,MACnBvB,GAAUuB,iBAAO,MACjBE,GAAaF,iBAAO,MACpBxB,GAAcwB,iBAAO,MAE3BG,qBAAU,WACR1D,EAAgBgC,GAAQI,WACvB,IAEHsB,qBAAU,WACRrD,EACEoD,GAAWrB,QACXH,EACA,CACEzB,WAAYmC,EACZlC,WACAE,aACAD,aACAI,YAAaxD,EAAKwD,IAClBD,cAAevD,EAAKuD,GACpBD,kBAEF1B,KAED,CAACyD,EAAelC,EAAUC,EAAYG,EAAeC,GAAaH,EAAYC,GAAeqB,IAEhGyB,qBAAU,WACRrD,EACE0B,GAAYK,QACZH,EACA,CAAEzB,WAAYqC,EAAgBpC,WAAUC,aAAYC,aAAYC,kBAChE3B,KAED,CAAC4D,EAAgBpC,EAAUC,EAAYE,GAAeD,EAAYsB,IAErE,IAAM0B,GAAO,uCAAG,8EAAAC,EAAA,sDACVC,EAAW,EACfP,GAAYlB,QAAQnB,MAAM6C,QAAU,QACpC9B,GAAQI,QAAQnB,MAAM8C,QAAU,EAEhC/D,EAAgByD,GAAWrB,SACrB4B,EAAoB,CAAEvD,WAAUC,aAAYC,cAC5CsD,EAPQ,2BAOoBD,GAPpB,IAOuCxD,WAAYqC,IAC3DqB,EARQ,2BASTF,GATS,IAUZxD,WAAYmC,EACZ9B,cAAevD,EAAKuD,GACpBC,YAAaxD,EAAKwD,MAGpBT,EAAKoD,GAAWrB,QAASpB,EAAmBiB,EAAMrB,IAAgBsD,EAAiBhF,GAC7E4C,EAAgBvC,EAAakE,GAAWrB,SAExC+B,EAA+C,GAAnBhD,OAAOV,GAEnC2D,GAAUD,EACVE,EAAOF,EAEPG,EAA6C,GAAnBnD,OAAOV,GAKjC8D,EAAiB,IACnBC,GAAoBH,EAAOD,GAAU,GACrCK,IAJEC,EAAOJ,IADPK,GAAUL,IAKyB,GAErClC,EAAU,CAAEwC,EAAG,EAAGC,EAAG,GAhCX,aAiCPL,EAAmBD,GAAkBE,EAAmBF,GAjCjD,oBAkCNO,EAAM,CACV,CAAEF,EAAGxC,EAAQwC,EAAGC,EAAGzC,EAAQyC,EAAIJ,GAC/B,CAAEG,EAAGxC,EAAQwC,EAAIJ,EAAkBK,EAAGzC,EAAQyC,GAC9C,CAAED,EAAGxC,EAAQwC,EAAGC,EAAGzC,EAAQyC,GAC3B,CAAED,EAAGxC,EAAQwC,EAAIJ,EAAkBK,EAAGzC,EAAQyC,GAC9C,CAAED,EAAGxC,EAAQwC,EAAGC,EAAGzC,EAAQyC,EAAIJ,IAC/BM,KAAI,gBAAGH,EAAH,EAAGA,EAAGC,EAAN,EAAMA,EAAN,MAAe,CACnBD,EAAGjH,KAAKqH,MAA+B,IAAzBxH,EAAMoH,EAAGR,EAAQC,IAAe,IAC9CQ,EAAGlH,KAAKqH,MAA+B,IAAzBxH,EAAMqH,EAAGF,EAAQD,IAAe,QA1CpC,EA6CQI,EACjBC,KAAI,gBAAGH,EAAH,EAAGA,EAAGC,EAAN,EAAMA,EAAN,OACHhD,EAAyBC,EAAeC,GAAaC,GAAShB,EAAmBiB,EAAMrB,IAA/D,YAAC,eACpBqD,GADmB,IAEtBpD,cAAevD,EAAKsH,GACpB9D,YAAaxD,EAAKuH,SAGrBI,QACC,SAACC,EAAKC,GAAN,MAAe,CAAC,GAAD,mBACTD,EAAI,IADK,CACDC,EAAK,KADJ,sBAETD,EAAI,IAFK,CAEDC,EAAK,QAEnB,CAAC,GAAI,KA1DG,mBA6CLC,EA7CK,KA6CA9C,EA7CA,KA6DN+C,EAAW1H,KAAKF,IAAL,MAAAE,KAAI,YAAQyH,IAEvBE,EAAgBF,EAAIG,QAAQF,GAE5BG,EAAUV,EAAIQ,GAEhBlD,IAAYoD,EAnEJ,wBA9KAhG,EAkPDwC,GAAQI,QAlPCzC,EAkPQ2C,EAAKgD,GAjPzB9F,EAAOE,WAAW,MAC1B+F,aAAa9F,EAAM,EAAG,GAiPpB6D,GAAUpB,QAAQsD,UAAlB,0CAAiE7B,EAAjE,aAA8E8B,KAAKC,UAAU,CAC3F/E,cAAevD,EAAKkI,EAAQZ,GAC5B9D,YAAaxD,EAAKkI,EAAQX,MAvElB,UAyEJjH,EA/SK,oBAsOD,QA4EZwE,EAAUoD,EACV3B,IAEAW,GAAoB7G,KAAKkI,IAAI,KAAOhC,GACpCY,GAAoB9G,KAAKkI,IAAI,KAAOhC,GAhFxB,wBAmFNe,GAnFM,EAmFGxC,GAATwC,EAAGC,EAnFG,EAmFHA,EAEXrD,EAAWQ,GAAQI,QAASpB,EAAmBiB,EAAMrB,IAAgB+B,EAAeE,EAA1E,YAAC,eACNmB,GADK,IAERpC,sBAAuBtE,EAAKuD,GAC5Bc,oBAAqBrE,EAAKwD,IAC1BD,cAAevD,EAAKsH,GACpB9D,YAAaxD,EAAKuH,MAGpBrB,GAAUpB,QAAQsD,UAAlB,qCAA4D7B,EAA5D,aAAyE8B,KAAKC,UAAU,CACtF/E,cAAevD,EAAKsH,GACpB9D,YAAaxD,EAAKuH,MA/FN,kCA9KD,IAACrF,EAAQG,IA8KR,OAAH,qDAmGPmG,GAAW,SAACC,EAAD,GAA2C,IAAfC,EAAc,EAAxBC,OAAUD,MAC3CD,GAAc,kBAAMC,MAGtB,OACE,sBAAKE,UAAU,MAAf,UACE,yBAAQA,UAAU,SAAlB,UACE,oBAAIA,UAAU,WAAd,wCACA,4BACE,8DAGJ,uBAAMA,UAAU,UAAhB,UACE,sBAAKA,UAAU,cAAf,UACE,sBAAKA,UAAU,WAAf,UACE,sBAAKA,UAAU,qBAAf,UACE,wBAAOC,QAAQ,YAAYD,UAAU,aAArC,sBAEE,8BACE,2CAGJ,uBACEE,OAAQN,GAASO,KAAK,KAAMrD,GAC5BkD,UAAU,eACVI,GAAG,YACHC,KAAK,SACLC,KAAK,IACLC,aA9UU,QAiVd,sBAAKP,UAAU,qBAAf,UACE,wBAAOC,QAAQ,cAAcD,UAAU,aAAvC,wBAEE,8BACE,2DAGJ,uBACEE,OAAQN,GAASO,KAAK,KAAMpD,GAC5BiD,UAAU,eACVI,GAAG,cACHC,KAAK,SACLC,KAAK,OACLC,aA7VY,YAiWlB,sBAAKP,UAAU,WAAf,UACE,sBAAKA,UAAU,qBAAf,UACE,uBAAOC,QAAQ,cAAcD,UAAU,aAAvC,yBAGA,yBACEJ,SAAUA,GAASO,KAAK,KAAMnD,GAC9BgD,UAAU,2BACVI,GAAG,cACHG,aAAc7H,EAJhB,UAME,wBAAQoH,MAAM,MAAd,iBACA,wBAAQA,MAAM,MAAd,iBACA,wBAAQA,MAAM,MAAd,iBACA,wBAAQA,MAAM,MAAd,iBACA,wBAAQA,MAAM,MAAd,iBACA,wBAAQA,MAAM,MAAd,iBACA,wBAAQA,MAAM,MAAd,iBACA,wBAAQA,MAAM,MAAd,iBACA,wBAAQA,MAAM,MAAd,uBAGJ,sBAAKE,UAAU,qBAAf,UACE,uBAAOC,QAAQ,iBAAiBD,UAAU,aAA1C,4BAGA,yBACEJ,SAAUA,GAASO,KAAK,KAAMhD,IAC9B6C,UAAU,2BACVI,GAAG,iBACHG,aAAc3H,EAJhB,UAME,wBAAQkH,MAAM,OAAd,kBACA,wBAAQA,MAAM,YAAd,uBACA,wBAAQA,MAAM,YAAd,gCAIN,sBAAKE,UAAU,WAAf,UACE,sBAAKA,UAAU,qBAAf,UACE,wBAAOC,QAAQ,iBAAiBD,UAAU,aAA1C,2BAEE,8BACE,yDAGJ,uBACEE,OAAQN,GAASO,KAAK,KAAMlD,GAC5B+C,UAAU,eACVI,GAAG,iBACHC,KAAK,SACLC,KAAK,OACLC,aA1Ze,OA6ZnB,sBAAKP,UAAU,qBAAf,UACE,wBAAOC,QAAQ,eAAeD,UAAU,aAAxC,yBAEE,8BACE,yDAGJ,uBACEE,OAAQN,GAASO,KAAK,KAAMjD,IAC5B8C,UAAU,eACVI,GAAG,eACHC,KAAK,SACLC,KAAK,OACLC,aAzaa,UA6anB,sBAAKP,UAAU,sBAAf,UACE,uBAAOA,UAAU,aAAaC,QAAQ,YAAtC,kBAGA,0BACEC,OAAQN,GAASO,KAAK,KAAMtD,GAC5BmD,UAAU,oBACVI,GAAG,YACHG,aAAcxI,OAGlB,oBAAIiI,UAAU,SACd,sBAAKA,UAAU,WAAf,UACE,sBAAKA,UAAU,qBAAf,UACE,uBAAOC,QAAQ,eAAeD,UAAU,aAAxC,4BAGA,sBAAKA,UAAU,cAAf,UACE,uBACEjF,MAAO,CAAET,WAAYmC,GACrBuD,UAAU,eACVI,GAAG,eACHC,KAAK,OACLP,MAAOrD,EACPmD,SAAUA,GAASO,KAAK,KAAMzD,GAC9BwD,OAAQN,GAASO,KAAK,KAAMzD,KAE9B,wBAAOuD,QAAQ,aAAaD,UAAU,2CAAtC,UACE,uBACEK,KAAK,OACLG,OAAO,8BACPR,UAAU,aACVJ,SAAU,SAACa,GACT,GAAIA,EAAEV,OAAOW,MAAO,CAAC,IACZC,EADW,YACHF,EAAEV,OAAOW,MADN,MAEdC,GAlUL,SAACA,EAAMC,GAAc,IAAD,EACxBD,EAATE,KAEoBC,MAAM,KAA3BC,EAHkC,oBAInCC,EAAMC,IAAIC,gBAAgBP,GAE1B5F,EAAQoG,SAASC,cAAc,SAErCrG,EAAMsG,YAAN,sDAEsBN,EAFtB,gCAGiBtB,KAAKC,UAAUsB,GAHhC,qBAOAG,SAASG,KAAKC,YAAYxG,GAE1B6F,EAASG,GAkTeS,CAAeb,EAAMjE,KAI3B0D,GAAG,eAEL,mDAIN,sBAAKJ,UAAU,qBAAf,UACE,uBAAOC,QAAQ,gBAAgBD,UAAU,aAAzC,6BAGA,uBACEjF,MAAO,CAAET,WAAYqC,GACrBqD,UAAU,eACVI,GAAG,gBACHC,KAAK,OACLE,aAAc5H,EACduH,OAAQN,GAASO,KAAK,KAAMvD,WAIlC,wBAAQoD,UAAU,kBAAkByB,QAAShE,GAA7C,iCAIF,qBAAKuC,UAAU,cAAc0B,IAAKpE,KAClC,sBAAKoE,IAAKtE,GAAa4C,UAAU,WAAjC,UACE,wBAAQ0B,IAAKnE,GAAYyC,UAAU,SAAS2B,MAAOnJ,EAAcoJ,OAAQnJ,EAAe2H,GAAG,YAC3F,wBAAQsB,IAAK7F,GAAamE,UAAU,SAAS2B,MAAOnJ,EAAcoJ,OAAQnJ,EAAe2H,GAAG,aAC5F,wBAAQsB,IAAK5F,GAASkE,UAAU,SAAS2B,MAAOnJ,EAAcoJ,OAAQnJ,EAAe2H,GAAG,mBCxgBlGyB,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,EAAD,MAEFZ,SAASa,eAAe,W","file":"static/js/main.0f22d0c1.chunk.js","sourcesContent":["export const toPx = (num) => `${num}px`;\n\nexport const clamp = (num, min, max) => Math.min(Math.max(num, min), max);\n\nexport const renderDelay = (time = 1000) => new Promise((resolve) => setTimeout(resolve, time));\n","import React, { useEffect, useRef, useState } from 'react';\nimport canvasTxt from 'canvas-txt';\nimport pixelmatch from 'pixelmatch';\n\nimport { toPx, clamp, renderDelay } from './helpers';\n\nimport './App.scss';\n\nconst DEFAULT_TEXT =\n  'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.';\n\nconst ONE_FRAME = 1 / 60;\nconst TEN_FRAMES = 10 * ONE_FRAME;\n\ncanvasTxt.vAlign = 'top';\ncanvasTxt.align = 'left';\ncanvasTxt.justify = false;\n\nconst PIXELMATCH_OPTIONS = {\n  threshold: 0.2,\n  includeAA: true,\n  diffMask: false,\n};\n\nconst CANVAS_PADDING_X = 20;\nconst CANVAS_PADDING_Y = 20;\n\nconst CANVAS_WIDTH = 500;\nconst CANVAS_HEIGHT = 400;\n\nconst DEFAULT_FONT_WEIGHT = 400;\nconst DEFAULT_LETTER_SPACING = 0;\nconst DEFAULT_WORD_SPACING = 0;\nconst DEFAULT_WEBFONT_FAMILY = 'Georgia';\nconst DEFAULT_FALLBACK_FAMILY = 'Times New Roman';\nconst DEFAULT_FONT_SIZE = 20;\nconst DEFAULT_LINE_HEIGHT = 1.1;\nconst DEFAULT_TEXT_TRANSFORM = 'none';\n\nconst BG_COLOR_WHITE = '#fff';\nconst BG_COLOR_RED = '#ff0000';\nconst BG_COLOR_BLACK = '#000';\nconst BG_COLOR_FALLBACK = '#FFF9B3';\nconst BG_COLOR_WEBFONT = '#B3FFCB';\n\nconst INITIAL_LETTER_SPACING = toPx(DEFAULT_LETTER_SPACING);\nconst INITIAL_WORD_SPACING = toPx(DEFAULT_WORD_SPACING);\n\nconst CANVAS_FRAME_FULL = [0, 0, CANVAS_WIDTH, CANVAS_HEIGHT];\n\nconst CANVAS_FRAME_TEXT = [\n  CANVAS_PADDING_X,\n  CANVAS_PADDING_Y,\n  CANVAS_WIDTH - CANVAS_PADDING_X * 2,\n  CANVAS_HEIGHT - CANVAS_PADDING_Y * 2,\n];\n\nconst getImageData = (canvas) => {\n  const ctx1 = canvas.getContext('2d');\n  return ctx1.getImageData(...CANVAS_FRAME_FULL).data;\n};\n\nconst createEmptyDiff = (canvas) => {\n  const diffCtx = canvas.getContext('2d');\n  diffCtx.clearRect(...CANVAS_FRAME_FULL);\n  return diffCtx.createImageData(CANVAS_WIDTH, CANVAS_HEIGHT);\n};\n\nconst drawDiff = (canvas, data) => {\n  const ctx = canvas.getContext('2d');\n  ctx.putImageData(data, 0, 0);\n};\n\nconst drawColoredRect = (canvas, color = BG_COLOR_WHITE) => {\n  const ctx = canvas.getContext('2d');\n  ctx.clearRect(...CANVAS_FRAME_FULL);\n  ctx.fillStyle = color;\n  ctx.fillRect(...CANVAS_FRAME_FULL);\n};\n\nconst draw = (\n  canvas,\n  txt,\n  {\n    fontFamily,\n    fontSize,\n    lineHeight,\n    fontWeight = DEFAULT_FONT_WEIGHT,\n    textTransform = DEFAULT_TEXT_TRANSFORM,\n    letterSpacing = INITIAL_LETTER_SPACING,\n    wordSpacing = INITIAL_WORD_SPACING,\n  },\n  bgColor,\n) => {\n  const transformedText = getTransformedText(txt, textTransform);\n  const ctx = canvas.getContext('2d');\n  drawColoredRect(canvas, bgColor);\n  canvas.style.letterSpacing = letterSpacing;\n  canvas.style.wordSpacing = wordSpacing;\n  ctx.fillStyle = BG_COLOR_BLACK;\n  canvasTxt.font = fontFamily;\n  canvasTxt.fontWeight = Number(fontWeight);\n  canvasTxt.fontSize = Number(fontSize);\n  canvasTxt.lineHeight = Number(lineHeight) * Number(fontSize);\n  canvasTxt.drawText(ctx, transformedText, ...CANVAS_FRAME_TEXT);\n};\n\nconst getTransformedText = (txt, transformType) => {\n  switch (transformType) {\n    case 'uppercase':\n      return txt.toUpperCase();\n    case 'lowercase':\n      return txt.toLowerCase();\n    case 'none':\n    default:\n      return txt;\n  }\n};\n\nconst drawResult = (\n  canvas,\n  txt,\n  originalFont,\n  fallbackFont,\n  {\n    fontSize,\n    lineHeight,\n    fontWeight = DEFAULT_FONT_WEIGHT,\n    wordSpacingOriginal = INITIAL_WORD_SPACING,\n    letterSpacingOriginal = INITIAL_LETTER_SPACING,\n    textTransform = DEFAULT_TEXT_TRANSFORM,\n    letterSpacing = INITIAL_LETTER_SPACING,\n    wordSpacing = INITIAL_WORD_SPACING,\n  },\n) => {\n  const transformedText = getTransformedText(txt, textTransform);\n  const ctx = canvas.getContext('2d');\n  drawColoredRect(canvas, BG_COLOR_WHITE);\n  ctx.fillStyle = BG_COLOR_BLACK;\n  canvas.style.letterSpacing = letterSpacingOriginal;\n  canvas.style.wordSpacing = wordSpacingOriginal;\n  canvasTxt.fontWeight = Number(fontWeight);\n  canvasTxt.font = originalFont;\n  canvasTxt.fontSize = Number(fontSize);\n  canvasTxt.lineHeight = Number(lineHeight) * Number(fontSize);\n  canvasTxt.drawText(ctx, transformedText, ...CANVAS_FRAME_TEXT);\n\n  canvas.style.letterSpacing = letterSpacing;\n  canvas.style.wordSpacing = wordSpacing;\n  ctx.fillStyle = BG_COLOR_RED;\n  canvasTxt.font = fallbackFont;\n  canvasTxt.fontWeight = Number(fontWeight);\n  canvasTxt.fontSize = Number(fontSize);\n  canvasTxt.lineHeight = Number(lineHeight) * Number(fontSize);\n  canvasTxt.drawText(ctx, transformedText, ...CANVAS_FRAME_TEXT);\n};\n\nconst drawFallbackWithSettings = (\n  originalImage,\n  fallbackRef,\n  diffRef,\n  text,\n  textSettings,\n  bgFallbackColor = BG_COLOR_FALLBACK,\n) => {\n  draw(fallbackRef.current, text, textSettings, bgFallbackColor);\n  const fallbackImage = getImageData(fallbackRef.current);\n  const diff = createEmptyDiff(diffRef.current);\n\n  const result = pixelmatch(originalImage, fallbackImage, diff.data, CANVAS_WIDTH, CANVAS_HEIGHT, PIXELMATCH_OPTIONS);\n\n  return [result, diff];\n};\n\nconst uploadFontFace = (file, callback) => {\n  const { name } = file;\n\n  const [fontFaceName] = name.split('.');\n  const url = URL.createObjectURL(file);\n\n  const style = document.createElement('style');\n\n  style.textContent = `\n      @font-face {\n        font-family: \"${fontFaceName}\";\n        src: url(${JSON.stringify(url)});\n      }\n    `;\n\n  document.head.appendChild(style);\n\n  callback(fontFaceName);\n};\n\nconst App = () => {\n  const [webfontFamily, setWebfontFamily] = useState(DEFAULT_WEBFONT_FAMILY);\n  const [fallbackFamily, setFallbackFamily] = useState(DEFAULT_FALLBACK_FAMILY);\n\n  const [text, setText] = useState(DEFAULT_TEXT);\n  const [fontSize, setFontSize] = useState(DEFAULT_FONT_SIZE);\n  const [lineHeight, setLineHeight] = useState(DEFAULT_LINE_HEIGHT);\n  const [fontWeight, setFontWeight] = useState(DEFAULT_FONT_WEIGHT);\n  const [letterSpacing, setLetterSpacing] = useState(DEFAULT_LETTER_SPACING);\n  const [wordSpacing, setWordSpacing] = useState(DEFAULT_WORD_SPACING);\n  const [textTransform, setTextTransform] = useState(DEFAULT_TEXT_TRANSFORM);\n\n  const drawAreaRef = useRef(null);\n  const resultRef = useRef(null);\n  const diffRef = useRef(null);\n  const webfontRef = useRef(null);\n  const fallbackRef = useRef(null);\n\n  useEffect(() => {\n    drawColoredRect(diffRef.current);\n  }, []);\n\n  useEffect(() => {\n    draw(\n      webfontRef.current,\n      text,\n      {\n        fontFamily: webfontFamily,\n        fontSize,\n        fontWeight,\n        lineHeight,\n        wordSpacing: toPx(wordSpacing),\n        letterSpacing: toPx(letterSpacing),\n        textTransform,\n      },\n      BG_COLOR_WEBFONT,\n    );\n  }, [webfontFamily, fontSize, lineHeight, letterSpacing, wordSpacing, fontWeight, textTransform, text]);\n\n  useEffect(() => {\n    draw(\n      fallbackRef.current,\n      text,\n      { fontFamily: fallbackFamily, fontSize, lineHeight, fontWeight, textTransform },\n      BG_COLOR_FALLBACK,\n    );\n  }, [fallbackFamily, fontSize, lineHeight, textTransform, fontWeight, text]);\n\n  const onMatch = async () => {\n    let progress = 0;\n    drawAreaRef.current.style.display = 'block';\n    diffRef.current.style.opacity = 1;\n\n    drawColoredRect(webfontRef.current);\n    const basicFontSettings = { fontSize, lineHeight, fontWeight };\n    const fallbackFontSettings = { ...basicFontSettings, fontFamily: fallbackFamily };\n    const webFontSettings = {\n      ...basicFontSettings,\n      fontFamily: webfontFamily,\n      letterSpacing: toPx(letterSpacing),\n      wordSpacing: toPx(wordSpacing),\n    };\n\n    draw(webfontRef.current, getTransformedText(text, textTransform), webFontSettings, BG_COLOR_WEBFONT);\n    const originalImage = getImageData(webfontRef.current);\n\n    const LETTER_SPACING_BOUNDARIES = Number(fontSize) * 0.2;\n\n    const lsFrom = -LETTER_SPACING_BOUNDARIES;\n    const lsTo = LETTER_SPACING_BOUNDARIES;\n\n    const WORD_SPACING_BOUNDARIES = Number(fontSize) * 0.2;\n\n    const wsFrom = -WORD_SPACING_BOUNDARIES;\n    const wsTo = WORD_SPACING_BOUNDARIES;\n\n    const anchorStepSize = 0.01;\n    let currentStepSizeX = (lsTo - lsFrom) / 10;\n    let currentStepSizeY = (wsTo - wsFrom) / 10;\n\n    let current = { x: 0, y: 0 };\n    while (currentStepSizeX > anchorStepSize && currentStepSizeY > anchorStepSize) {\n      const arr = [\n        { x: current.x, y: current.y - currentStepSizeY },\n        { x: current.x - currentStepSizeX, y: current.y },\n        { x: current.x, y: current.y },\n        { x: current.x + currentStepSizeX, y: current.y },\n        { x: current.x, y: current.y + currentStepSizeY },\n      ].map(({ x, y }) => ({\n        x: Math.round(clamp(x, lsFrom, lsTo) * 100) / 100,\n        y: Math.round(clamp(y, wsFrom, wsTo) * 100) / 100,\n      }));\n\n      const [res, diff] = arr\n        .map(({ x, y }) =>\n          drawFallbackWithSettings(originalImage, fallbackRef, diffRef, getTransformedText(text, textTransform), {\n            ...fallbackFontSettings,\n            letterSpacing: toPx(x),\n            wordSpacing: toPx(y),\n          }),\n        )\n        .reduce(\n          (acc, curr) => [\n            [...acc[0], curr[0]],\n            [...acc[1], curr[1]],\n          ],\n          [[], []],\n        );\n\n      const localMin = Math.min(...res);\n\n      const localMinIndex = res.indexOf(localMin);\n\n      const nextMin = arr[localMinIndex];\n\n      if (current !== nextMin) {\n        drawDiff(diffRef.current, diff[localMinIndex]);\n        resultRef.current.innerText = `In Progress: Minimization Round ${progress}\\n${JSON.stringify({\n          letterSpacing: toPx(nextMin.x),\n          wordSpacing: toPx(nextMin.y),\n        })}`;\n        await renderDelay(TEN_FRAMES);\n      }\n\n      current = nextMin;\n      progress++;\n\n      currentStepSizeX *= Math.pow(0.999, progress);\n      currentStepSizeY *= Math.pow(0.999, progress);\n    }\n\n    const { x, y } = current;\n\n    drawResult(diffRef.current, getTransformedText(text, textTransform), webfontFamily, fallbackFamily, {\n      ...basicFontSettings,\n      letterSpacingOriginal: toPx(letterSpacing),\n      wordSpacingOriginal: toPx(wordSpacing),\n      letterSpacing: toPx(x),\n      wordSpacing: toPx(y),\n    });\n\n    resultRef.current.innerText = `Done on Minimization Round ${progress}\\n${JSON.stringify({\n      letterSpacing: toPx(x),\n      wordSpacing: toPx(y),\n    })}`;\n  };\n\n  const onChange = (changeHandler, { target: { value } }) => {\n    changeHandler(() => value);\n  };\n\n  return (\n    <div className=\"App\">\n      <header className=\"header\">\n        <h1 className=\"headline\">Auto Fallback Font Matcher</h1>\n        <p>\n          <em>* only tested in Chrome</em>\n        </p>\n      </header>\n      <main className=\"content\">\n        <div className=\"config mb-4\">\n          <div className=\"row mb-4\">\n            <div className=\"config-field col-6\">\n              <label htmlFor=\"font-size\" className=\"form-label\">\n                Font Size\n                <sup>\n                  <em>(px)</em>\n                </sup>\n              </label>\n              <input\n                onBlur={onChange.bind(null, setFontSize)}\n                className=\"form-control\"\n                id=\"font-size\"\n                type=\"number\"\n                step=\"1\"\n                defaultValue={DEFAULT_FONT_SIZE}\n              />\n            </div>\n            <div className=\"config-field col-6\">\n              <label htmlFor=\"line-height\" className=\"form-label\">\n                Line Height\n                <sup>\n                  <em>(unitless, relative)</em>\n                </sup>\n              </label>\n              <input\n                onBlur={onChange.bind(null, setLineHeight)}\n                className=\"form-control\"\n                id=\"line-height\"\n                type=\"number\"\n                step=\"0.01\"\n                defaultValue={DEFAULT_LINE_HEIGHT}\n              />\n            </div>\n          </div>\n          <div className=\"row mb-4\">\n            <div className=\"config-field col-6\">\n              <label htmlFor=\"font-weight\" className=\"form-label\">\n                Font Weight\n              </label>\n              <select\n                onChange={onChange.bind(null, setFontWeight)}\n                className=\"form-control form-select\"\n                id=\"font-weight\"\n                defaultValue={DEFAULT_FONT_WEIGHT}\n              >\n                <option value=\"100\">100</option>\n                <option value=\"200\">200</option>\n                <option value=\"300\">300</option>\n                <option value=\"400\">400</option>\n                <option value=\"500\">500</option>\n                <option value=\"600\">600</option>\n                <option value=\"700\">700</option>\n                <option value=\"800\">800</option>\n                <option value=\"900\">900</option>\n              </select>\n            </div>\n            <div className=\"config-field col-6\">\n              <label htmlFor=\"text-transform\" className=\"form-label\">\n                Text Transform\n              </label>\n              <select\n                onChange={onChange.bind(null, setTextTransform)}\n                className=\"form-control form-select\"\n                id=\"text-transform\"\n                defaultValue={DEFAULT_TEXT_TRANSFORM}\n              >\n                <option value=\"none\">None</option>\n                <option value=\"uppercase\">Uppercase</option>\n                <option value=\"lowercase\">Lowercase</option>\n              </select>\n            </div>\n          </div>\n          <div className=\"row mb-4\">\n            <div className=\"config-field col-6\">\n              <label htmlFor=\"letter-spacing\" className=\"form-label\">\n                Letter Spacing\n                <sup>\n                  <em>(px, webfont only)</em>\n                </sup>\n              </label>\n              <input\n                onBlur={onChange.bind(null, setLetterSpacing)}\n                className=\"form-control\"\n                id=\"letter-spacing\"\n                type=\"number\"\n                step=\"0.01\"\n                defaultValue={DEFAULT_LETTER_SPACING}\n              />\n            </div>\n            <div className=\"config-field col-6\">\n              <label htmlFor=\"word-spacing\" className=\"form-label\">\n                Word Spacing\n                <sup>\n                  <em>(px, webfont only)</em>\n                </sup>\n              </label>\n              <input\n                onBlur={onChange.bind(null, setWordSpacing)}\n                className=\"form-control\"\n                id=\"word-spacing\"\n                type=\"number\"\n                step=\"0.01\"\n                defaultValue={DEFAULT_WORD_SPACING}\n              />\n            </div>\n          </div>\n          <div className=\"config-field col-12\">\n            <label className=\"form-label\" htmlFor=\"font-text\">\n              Text\n            </label>\n            <textarea\n              onBlur={onChange.bind(null, setText)}\n              className=\"form-control text\"\n              id=\"font-text\"\n              defaultValue={DEFAULT_TEXT}\n            />\n          </div>\n          <hr className=\"my-4\" />\n          <div className=\"row mb-4\">\n            <div className=\"config-field col-6\">\n              <label htmlFor=\"font-webfont\" className=\"form-label\">\n                Webfont Family\n              </label>\n              <div className=\"input-group\">\n                <input\n                  style={{ fontFamily: webfontFamily }}\n                  className=\"form-control\"\n                  id=\"font-webfont\"\n                  type=\"text\"\n                  value={webfontFamily}\n                  onChange={onChange.bind(null, setWebfontFamily)}\n                  onBlur={onChange.bind(null, setWebfontFamily)}\n                />\n                <label htmlFor=\"uploadFont\" className=\"input-group-text upload-icon btn-primary\">\n                  <input\n                    type=\"file\"\n                    accept=\".ttf,.otf,.woff,.woff2,.svg\"\n                    className=\"uploadFont\"\n                    onChange={(e) => {\n                      if (e.target.files) {\n                        const [file] = e.target.files;\n                        if (file) {\n                          uploadFontFace(file, setWebfontFamily);\n                        }\n                      }\n                    }}\n                    id=\"uploadFont\"\n                  />\n                  <span>&#8683;</span>\n                </label>\n              </div>\n            </div>\n            <div className=\"config-field col-6\">\n              <label htmlFor=\"font-fallback\" className=\"form-label\">\n                Fallback Family\n              </label>\n              <input\n                style={{ fontFamily: fallbackFamily }}\n                className=\"form-control\"\n                id=\"font-fallback\"\n                type=\"text\"\n                defaultValue={DEFAULT_FALLBACK_FAMILY}\n                onBlur={onChange.bind(null, setFallbackFamily)}\n              />\n            </div>\n          </div>\n          <button className=\"btn btn-primary\" onClick={onMatch}>\n            Start Auto Match\n          </button>\n        </div>\n        <div className=\"result mb-4\" ref={resultRef} />\n        <div ref={drawAreaRef} className=\"drawArea\">\n          <canvas ref={webfontRef} className=\"canvas\" width={CANVAS_WIDTH} height={CANVAS_HEIGHT} id=\"webfont\" />\n          <canvas ref={fallbackRef} className=\"canvas\" width={CANVAS_WIDTH} height={CANVAS_HEIGHT} id=\"fallback\" />\n          <canvas ref={diffRef} className=\"canvas\" width={CANVAS_WIDTH} height={CANVAS_HEIGHT} id=\"diff\" />\n        </div>\n      </main>\n    </div>\n  );\n};\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport './reset.css';\nimport 'bootstrap/scss/bootstrap.scss';\nimport './index.scss';\n\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root'),\n);\n"],"sourceRoot":""}